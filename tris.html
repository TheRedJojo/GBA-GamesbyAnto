<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tris Mania - GBA (NES)</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="website icon" type="png" href="img/TRIS.png">
<style>
  html, body {
  overflow: hidden;
  height: 100%;
  touch-action: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 10px;
}
:root{--bg:#081018;--panel:#0f1724;--accent:#FFD27F;--muted:#9AA6B2;--text:#EAE6DA;}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:'Press Start 2P',monospace;
  background:linear-gradient(180deg,#081018,#07101a);
  color:var(--text);
  display:flex; align-items:center; justify-content:center;
  padding:18px;
}
.frame{
  width:min(760px,96vw);
  background:linear-gradient(180deg,#081827,#041018);
  border:4px solid #000;
  padding:16px;border-radius:6px; display:flex; gap:18px; align-items:flex-start;
}
.left{width:52%}
.right{width:48%;display:flex;flex-direction:column;gap:10px;align-items:center}
.header{display:flex;justify-content:space-between;align-items:center}
.logo{color:var(--accent);font-size:14px}
.controls{display:flex;gap:8px}
.btn{padding:10px 12px;background:#111;border:3px solid #000;color:var(--text);cursor:pointer;border-radius:6px;font-size:11px}
.btn:hover{background:var(--accent); color:#000}
.board{display:grid;grid-template-columns:repeat(3, 110px);grid-gap:6px;padding:8px;background:#02101a;border-radius:6px;border:3px solid #000}
.cell{width:110px;height:110px;background:#081827;display:flex;align-items:center;justify-content:center;font-size:44px;cursor:pointer;border:2px solid #000; color:var(--text)}
.hud{font-size:12px;color:var(--text); text-align:left}
.scan{position:fixed;inset:0;pointer-events:none;background-image:linear-gradient(rgba(0,0,0,0.03) 50%, transparent 51%);background-size:100% 4px;opacity:.35}
.footer{position:fixed;left:12px;bottom:8px;color:var(--muted);font-size:11px}
.credits{position:fixed;right:12px;bottom:8px;color:var(--muted);font-size:11px}
@media(max-width:760px){ .board{grid-template-columns:repeat(3, 28vw)} .cell{width:28vw;height:28vw;font-size:8vw} }
</style>
</head>
<body>
<div class="frame">
  <div class="left">
    <div class="header">
      <div class="logo">GBA â€” TrisMania</div>
      <div class="controls">
        <div class="btn" id="btnResetRound">RIAVVIA</div>
        <div class="btn" id="btnMenu" onclick="location.href='index.html'">MENU</div>
      </div>
    </div>

    <div style="margin-top:12px">
      <div id="board" class="board"></div>
    </div>
  </div>

  <div class="right">
    <div class="hud">
      <div>Round score</div>
      <div style="margin-top:8px">O: <span id="scoreO">0</span></div>
      <div>X: <span id="scoreX">0</span></div>
      <div style="margin-top:12px;color:#FFD27F" id="status">Turno: O</div>
    </div>
  </div>
</div>

<div class="scan"></div>
<div class="footer">Versione Beta (1.0.0)</div>
<div class="credits">Fatto da Anto e ChatGPT</div>

<script>
/* Tris logic with ensured draw of winning symbol before announcing */
const boardEl=document.getElementById('board');
let grid = Array(9).fill('');
let turn='O';
let active=true;
let scoreO=0, scoreX=0;
const scoreOEl=document.getElementById('scoreO'), scoreXEl=document.getElementById('scoreX'), statusEl=document.getElementById('status');

function renderBoard(){
  boardEl.innerHTML='';
  grid.forEach((v,i)=>{
    const c=document.createElement('div'); c.className='cell'; c.dataset.i=i;
    c.textContent = v;
    c.addEventListener('click',()=> cellClick(i));
    boardEl.appendChild(c);
  });
  statusEl.textContent = 'Turno: ' + turn;
}
function cellClick(i){
  if(!active || grid[i]!== '') return;
  grid[i]=turn;
  renderBoard();
  // check winner
  const w = checkWinner();
  if(w){
    // ensure the winning symbol is visible (it already is because we set grid)
    // small delay then process endRound so player sees symbol
    active=false;
    setTimeout(()=> endRound(w), 260);
    return;
  }
  if(!grid.includes('')){
    // draw
    active=false;
    statusEl.textContent = 'Pareggio';
    setTimeout(()=> resetRound(), 900);
    return;
  }
  turn = (turn==='O')? 'X' : 'O';
  statusEl.textContent = 'Turno: ' + turn;
}
function checkWinner(){
  const lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  for(let line of lines){
    const [a,b,c]=line;
    if(grid[a] && grid[a]===grid[b] && grid[a]===grid[c]) return grid[a];
  }
  return null;
}
function endRound(winner){
  // winner already drawn on board
  if(winner==='O') scoreO++; else scoreX++;
  scoreOEl.textContent = scoreO; scoreXEl.textContent = scoreX;
  statusEl.textContent = `Vince il round: ${winner}`;
  // if someone reached 3, match over
  if(scoreO>=3 || scoreX>=3){
    setTimeout(()=> {
      statusEl.textContent = `Vince la partita: ${ winner }`;
      // reset both scores after short pause
      setTimeout(()=> { scoreO=0; scoreX=0; scoreOEl.textContent='0'; scoreXEl.textContent='0'; resetRound(); }, 1000);
    }, 500);
  } else {
    // reset board for next round after short pause
    setTimeout(()=> resetRound(), 900);
  }
}
function resetRound(){
  grid = Array(9).fill('');
  turn='O';
  active=true;
  renderBoard();
}
document.getElementById('btnResetRound').addEventListener('click', resetRound);
renderBoard();
</script>
</body>
</html>
