<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PixelSnake - GBA (NES)</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<link rel="website icon" type="png" href="img/SNAKE.png">
<style>
:root{--bg:#081018;--panel:#0f1724;--accent:#FFD27F;--muted:#9AA6B2;--text:#EAE6DA;}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:'Press Start 2P',monospace;
  background:linear-gradient(180deg,#081018,#07101a);
  color:var(--text);
  display:flex; align-items:center; justify-content:center;
  padding:18px;
}
.wrapper{
  width:min(760px,98vw);
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
  border:4px solid #000;
  padding:16px;
  border-radius:6px;
  display:flex; gap:12px; align-items:flex-start;
}
.left{width:52%;}
.right{width:48%;display:flex;flex-direction:column;gap:10px;align-items:center;}
.header{display:flex;justify-content:space-between;align-items:center;width:100%;}
.logo{color:var(--accent);font-size:14px}
.controls{display:flex;gap:8px;flex-wrap:wrap}
.btn{padding:10px 12px;background:#111;border:3px solid #000;color:var(--text);cursor:pointer;border-radius:6px;font-size:11px}
.btn:hover{background:var(--accent);color:#000; transform:translateY(-2px)}
.canvasWrap{background:#07101a;padding:10px;border-radius:6px;border:3px solid #000}
canvas{display:block;background:#111;border:2px solid #000; image-rendering:pixelated}
/* messages */
.hud{font-size:12px;color:var(--text);text-align:left}
.scan{position:fixed;inset:0;pointer-events:none;background-image:linear-gradient(rgba(0,0,0,0.03) 50%, transparent 51%);background-size:100% 4px;opacity:.35}
.footer{position:fixed;left:12px;bottom:8px;color:var(--muted);font-size:11px}
.credits{position:fixed;right:12px;bottom:8px;color:var(--muted);font-size:11px}
@media (max-width:760px){ .wrapper{flex-direction:column;align-items:center} .left,.right{width:100%} canvas{width:92vw;height:92vw} }
</style>
</head>
<body>
<div class="wrapper">
  <div class="left">
    <div class="header"><div class="logo">GBA — PixelSnake</div>
      <div class="controls">
        <div class="btn" id="btnRestart">RIAVVIA</div>
        <div class="btn" id="btnMenu" onclick="location.href='index.html'">MENU</div>
      </div>
    </div>

    <div class="canvasWrap" style="margin-top:12px;">
      <canvas id="game" width="300" height="300"></canvas>
    </div>
  </div>

  <div class="right">
    <div class="hud">
      <div>Punteggio: <span id="score">0</span></div>
      <div>Record: <span id="hs">0</span></div>
      <div id="message" style="margin-top:8px;color:#FFD27F;height:42px"></div>
    </div>
    <div style="font-size:11px;color:var(--muted);margin-top:10px">Controlli: frecce (PC) / swipe (touch)</div>
  </div>
</div>

<div class="scan"></div>
<div class="footer">Versione Beta (1.0.0)</div>
<div class="credits">Fatto da Anto e ChatGPT</div>

<script>
/* PixelSnake logic, NES style, no blocking alerts */
const canvas=document.getElementById('game'), ctx=canvas.getContext('2d');
const GRID=15;
let snake=[], dir={x:0,y:0}, food={x:0,y:0}, score=0;
let hs = parseInt(localStorage.getItem('gba_snake_hs')||0);
let running=false, over=false, tick=140, timer=null;
const scoreEl=document.getElementById('score'), hsEl=document.getElementById('hs'), msg=document.getElementById('message');

hsEl.textContent = hs;

function randPos(){
  return {
    x: Math.floor(Math.random()*(canvas.width/GRID)),
    y: Math.floor(Math.random()*(canvas.height/GRID))
  };
}
function placeFood(){
  food=randPos();
  // avoid placing on snake
  for(let s of snake){
    if(s.x===food.x && s.y===food.y){ food=randPos(); }
  }
}
function reset(initStart=false){
  snake=[{x:10,y:10}];
  dir={x:0,y:0};
  score=0; over=false; running=false; msg.textContent='';
  placeFood();
  render();
  if(initStart){ startLoop(); }
}
function startLoop(){
  if(timer) clearInterval(timer);
  timer=setInterval(loop, tick);
  running=true;
}
/* Draw */
function render(){
  ctx.fillStyle='#081018';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  // food
  ctx.fillStyle='#FFD27F';
  ctx.fillRect(food.x*GRID, food.y*GRID, GRID, GRID);
  // snake
  ctx.fillStyle='#8EE5A6';
  for(let s of snake) ctx.fillRect(s.x*GRID, s.y*GRID, GRID, GRID);
  // HUD (drawn in DOM)
  scoreEl.textContent=score;
  hsEl.textContent=hs;
}
function endGame(){
  over=true; running=false;
  clearInterval(timer);
  msg.textContent = 'Hai perso — punteggio: ' + score;
  setTimeout(()=>{ reset(true); }, 1400);
}
function loop(){
  if(!running || over) return;
  const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
  // bounds
  if(head.x < 0 || head.y < 0 || head.x >= canvas.width/GRID || head.y >= canvas.height/GRID){
    endGame(); return;
  }
  // self collision
  for(let i=0;i<snake.length;i++){ if(i>0 && snake[i].x===head.x && snake[i].y===head.y){ endGame(); return; } }
  snake.unshift(head);
  if(head.x===food.x && head.y===food.y){
    score++;
    if(score>hs){ hs=score; localStorage.setItem('gba_snake_hs', hs); msg.textContent = 'Nuovo record: '+hs; }
    placeFood();
  } else {
    snake.pop();
  }
  render();
}

/* keyboard */
document.addEventListener('keydown',e=>{
  if(e.key==='ArrowUp' && dir.y!==1) dir={x:0,y:-1};
  if(e.key==='ArrowDown' && dir.y!==-1) dir={x:0,y:1};
  if(e.key==='ArrowLeft' && dir.x!==1) dir={x:-1,y:0};
  if(e.key==='ArrowRight' && dir.x!==-1) dir={x:1,y:0};
  if(!running && !over){ startLoop(); }
});
/* touch swipe */
let sx=0, sy=0;
canvas.addEventListener('touchstart', e=>{ const t=e.touches[0]; sx=t.clientX; sy=t.clientY; }, {passive:true});
canvas.addEventListener('touchend', e=>{
  const t=e.changedTouches[0];
  const dx=t.clientX - sx, dy=t.clientY - sy;
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>0 && dir.x!==-1) dir={x:1,y:0};
    if(dx<0 && dir.x!==1) dir={x:-1,y:0};
  } else {
    if(dy>0 && dir.y!==-1) dir={x:0,y:1};
    if(dy<0 && dir.y!==1) dir={x:0,y:-1};
  }
  if(!running && !over) startLoop();
}, {passive:true});

/* buttons */
document.getElementById('btnRestart').addEventListener('click',()=>{ reset(true); });

/* init */
reset(true);
render();
</script>
</body>
</html>
